\documentclass[12pt, letterpaper]{report}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[english,polish]{babel}
\usepackage{fancyhdr}
\usepackage{hyperref}
\usepackage{wrapfig}
\usepackage{subcaption}
\usepackage{graphicx}
\graphicspath{ {images/} {images/collisions24x10_2x2} }

\usepackage[margin=1.5cm]{geometry}

\title{
    Raport z postępów pracy \\
    \large Modelowanie elastycznych i nieelastycznych
    zderzeń obiektów\\
    metodą dynamiki molekularnej na potrzeby animacji
    komputerowych
}
\author{
    Kamil Pasterczyk \\
    \small Promotor: dr hab. inż. Tomasz Chwiej
}

\begin{document}

\maketitle
\tableofcontents

\chapter{Wstęp}
    \section{Cele projektu}
    Jedną z popularnych metod wykorzystywanych w modelowaniu zderzeń obiektów w mikro- i makroskali jest metoda dynamiki molekularnej. 
    Mimo iż w pierwotnej postaci stosowana była do opisu własności gazów i cieczy, to dzięki swej wszechstronności pozwala modelować 
    obiekty makroskopowe zachowujących kształt przy braku sił zewnętrznych oraz 
    modelować ich rozrywanie w trakcie zderzeń z innymi obiektami. 
    W pracy należy zaadoptować odpowiednio sparametryzowany model dynamiki molekularnej i na jego 
    podstawie opracować algorytmy numeryczne do symulacji zderzeń obiektów z możliwością penetracji lub rozrywania jednego z nich. 
    Algorytmy powinny być zaimplementowany na tyle wydajne aby możliwa była wizualizacja 
    zderzeń w czasie rzeczywistym jako animacje komputerowe.

\chapter{Rozwinięcie}
    \section{Test poprawność działania algorytmów}
    \subsection{Opis testu}
    
    \begin{wrapfigure}{r}{0.5\textwidth}
        \includegraphics[width=0.9\linewidth]{objects_raw} 
        \caption{Widok aplikacji w fazie testów z widocznymi dwoma obiektami $8 \times 8$ oraz $6 \times 4$}
    \end{wrapfigure}
    Jeżeli wszystkie algorytmy symulujące odziaływania fizyczne zostały zimplementowane poprawnie 
    to w przypadku gdy nie występują żadne siły oporu energia całkowita układu powinna 
    być stała przez cały czas trwania symulacji. 
    Aby uzyskać poprawny obraz sytuacji należy uwzględnić
    wszystkie rodzaje energii w układzie: 
    \begin{enumerate}
        \item Energia potencjalna grawitacji
        \item Energia kinetyczna
        \item Energia potencjalna węwnątrz obiektu
        \item Energia potencjalna odpychająca pomiędzy obiektami a podłożem
        \item Energia potencjalna odpychająca pomiędzy dwoma obiektami
    \end{enumerate}
    Do testu zachowania energii wykorzystane są 
    dwa obiekty o rozmiarach odpowiednio $8 \times 8$ i $6 \times 4$ oraz statyczne podłoże. Obiekty
    znajdują się w polu grawitacyjnym, nie ma żadnych sił oporu/tarcia.

    \subsubsection{Parametry symulacji}
    $g = 9.81 [\frac{m}{s^2}]$\\
    $dt = 10^{-5} [s]$\\
    $t_{max} = 8 [s]$\\ \\ \\ \\

    \pagebreak
    \subsection{Wyniki}
    \begin{figure}[h]
        \centering
        \includegraphics[width=13cm]{energy_test_0to2s}
        \caption{Zmiana enegii w czasie dla układu w ciągu pierwszych 1.2 sekund}
    \end{figure}

    Przy zderzeniach pomiędzy obiektami oraz pomiędzy obiektem i podłożem energia potencjalna
    odpychająca Lennarda-Jonesa oznaczona kolejno kolorami pomarańczowym i czerwonym
    wyraźnie wzrasta.
    \begin{figure}[h]
        \centering
        \includegraphics[width=13cm]{energy_test_0to8s}
        \caption{Zmiana enegii w czasie dla układu w ciągu pierwszych 8 sekund}
    \end{figure}
    
    Po upłynięciu kilku sekund obiekty zostają przy podłożu, energia będąca początkowo energią
    potencjalną grawitacji została w większości zamieniona na energię kinetyczną oraz energię
    wewnętrzną. Obiekty nie odbijają się one już między sobą.
    Zmiana energii całkowitej w czasie działania całej symulacji była mniejsza niż $1\%$. Na tej
    podstawie można uznać, że algorytmy zostały zaimplementowane poprawnie.


    \section{Test wydajności dla dwóch algorytmów obsługi zderzeń między obiektami}
    \subsection{Opis algorytmów}
    Naszym celem jest obliczanie siły poędzy odpowiednimi węzłami w taki sposób aby 
    obiekty przy zderzeniu odpychały się od siebie.
    
    \begin{figure}[h]

        \begin{subfigure}{0.5\textwidth}
        \includegraphics[width=0.9\linewidth, height=6cm]{objects_unoptimized} 
        \caption{Metoda "każdy z każdym"}
        \end{subfigure}
        \begin{subfigure}{0.5\textwidth}
        \includegraphics[width=0.9\linewidth, height=6cm]{objects_optimized}
        \caption{Metoda węzłów granicznych}
        \end{subfigure}
        
        \caption{Reprezentacja dwóch metod obsługi zderzeń}
    \end{figure}

    Dla metody (a) oddziaływanie liczone jest pomiędzy każdym węzłem o kolorze 
    niebieskim z każdym węzłem o
    kolorze pomarańczowym. Metoda o złożoności $O(n^2)$ gdzie $n$ to liczba węzłów.
    Jest to metoda bardzo wolna, lecz dająca poprawne rezultaty w każdym symulowanym przypadku.\\

    Dla metody (b) oddziaływanie ponownie liczone jest pomiędzy każdym węzłem o kolorze niebieskim z każdym
    węzłem o kolorze pomarańczowym, tym razem jednak oznaczone są jedynie węzły brzegowe.
    Metoda ta jest szczególnie efektywna dla obiektów kwadratowych o boku $n$, gdzie z $n^2$
    rozpatrywanych węzłów ta liczba jest zmniejszona do zaledwie $4(n-1)$ węzłów.
    Należy zwrócić uwagę, że metoda ta nie będzie poprawnie odwzorowywać oddziaływań dla
    obiektów zagnieżdżonych w sobie. Przykładowa sytuacja, w której algorytm nie zadziała poprawnie
    to symulacja penetracji obiektu przy kuli/naboju.

    \newpage
    \subsection{Wyniki}
    Rozpatrujemy scenariusz z dwoma obiektami, sprawdzamy liczbę iteracji symulacji na sekundę stopniowo
    zwiększając liczbę węzłów w obydwóch obiektach. Test został wykonany na pojedynczym rdzeniu procesora AMD Ryzen 5 5600X, 
    ilość węzłów w bokach obiektów ustawiana jest kolejno na: 3, 5, 9, 10, 15, 21, 25, 30, 35, 40, 45, 50, 55, 60.

    \begin{figure}[h]
        \centering
        \includegraphics[width=15cm]{performance_side_size}
        \caption{
            Liczba iteracji na sekundę w zależności od 
            ilości węzłów w bokach obiektów dla dwóch metod obsługi zderzeń
        }
    \end{figure}


    Porównanie wydajności przypadku niezoptymalizowanego (a) i zoptymalizowanego (b):
    \begin{center}
        \begin{tabular}{||c c c c||} 
         \hline
         węzły w boku obiektu & $iteracje / [s]$ dla (a) & $iteracje / [s]$ dla (b) & krotność przyśpieszenia \\ [0.5ex] 
         \hline\hline
         3 & 777633 & 848867 & 1.09 \\ 
         \hline
         5 & 155426 & 243030 & 1.56 \\
         \hline
         9 & 19496 & 65263 & 3.34 \\
         \hline
         15 & 2899 & 21951 & 7.57 \\
         \hline
         21 & 782 & 10798 & 13.79 \\
         \hline
         25 & 393 & 7511 & 19.06 \\
         \hline
         30 & 191 & 5128 & 26.76 \\
         \hline
         35 & 104 & 3749 & 36.00 \\
         \hline
         40 & 61 & 2777 & 45.33 \\ 
         \hline
         45 & 38 & 2232 & 58.43 \\ 
         \hline
         50 & 25 & 1801 & 71.63 \\
         \hline
         55 & 17 & 1481 & 86.11 \\ 
         \hline
         60 & 12 & 1229 & 100.88 \\ [1ex] 
         \hline
        \end{tabular}
    \end{center}
    
    Dla większych obiektów zyski z zastosowanej optymalizacji są bardzo duże. Dla dwóch obiektów
    $60 \times 60$ ilość iteracji dla przypadku zoptymalizowanego jest ponad $100$ razy większa.

    \section{Test rozrywania obiektu}
    \subsection{Opis testu}
    Obiekt 01: damping 5.0, mass 1.0, spacing 0.08, v0 70.0, offset (-0.92, -0.925) \\
    Obiekt 02: damping 1.0, mass (30.0, 50.0, 80.0), spacing 0.15, v0 500.0, offset (-0.12, 0.8) \\
    Odpychanie międzyobiektowe:
    let v0 = 20.0;
    let dx = 0.07;
    Jeżeli ogległość między dwoma położonymi węzłami  oddali się 

    \subsection{Wyniki dla 120 kg}
    \begin{figure}[h]

        \begin{subfigure}{0.5\textwidth}
            \centering
            \includegraphics[width=6cm, height=6cm]{collision_2x2_24x12_mass30_1} 
            \caption{Stan początkowy}
        \end{subfigure}
        \begin{subfigure}{0.5\textwidth}
            \centering
            \includegraphics[width=6cm, height=6cm]{collision_2x2_24x12_mass30_2}
            \caption{Zderzenie}
        \end{subfigure}
        \begin{subfigure}{0.5\textwidth}
            \centering
            \includegraphics[width=6cm, height=6cm]{collision_2x2_24x12_mass30_3}
            \caption{Chwila po zderzeniu}
        \end{subfigure}
        \begin{subfigure}{0.5\textwidth}
            \centering
            \includegraphics[width=6cm, height=6cm]{collision_2x2_24x12_mass30_4}
            \caption{Stan stabilny}
        \end{subfigure}
        
        \caption{Zderzenie spadającego obiektu $2 \times 2$ o masie 120 kg na obiekt $12 \times 24$ o masie 288 kg}
    \end{figure}
    Masa pojednczczego węzła w wolno spadającym obiekcie wynosi 30 kg co daje łączną masę równą 120 kg.
    Węzły o kolorze czarnym mają zerową energię kinetyczną, 
    zmienieją kolor na czerwony proporcjonalnie do ilości posiadanej energii kinetczynej. 
    Przy zderzeniu widoczny jest transfer energii kinetcznej z obiektu $2 \times 2$ do obiektu $12 \times 24$, 
    w którym po chwili zaczyna rozchodzić się fala. Ze względu na zastosowanie siły oporu proporcjonalnej do prękości
    po kilku sekundach układ stabilizuje się, obiekt $2 \times 2$ leży nieruchomo na obiekcie $12 \times 24$. 
    Żadne z połączeń międzywęzłowych nie zostało przerwane ze względu na zbyt niską energię zderzenia.

    \newpage
    \subsection{Wyniki dla 200 kg}
    \begin{figure}[h]

        \begin{subfigure}{0.5\textwidth}
            \centering
            \includegraphics[width=6cm, height=6cm]{collision_2x2_24x12_mass50_1} 
            \caption{Stan początkowy}
        \end{subfigure}
        \begin{subfigure}{0.5\textwidth}
            \centering
            \includegraphics[width=6cm, height=6cm]{collision_2x2_24x12_mass50_2}
            \caption{Zderzenie}
        \end{subfigure}
        \begin{subfigure}{0.5\textwidth}
            \centering
            \includegraphics[width=6cm, height=6cm]{collision_2x2_24x12_mass50_3}
            \caption{Chwila po zderzeniu}
        \end{subfigure}
        \begin{subfigure}{0.5\textwidth}
            \centering
            \includegraphics[width=6cm, height=6cm]{collision_2x2_24x12_mass50_4}
            \caption{Stan stabilny}
        \end{subfigure}
        
        \caption{Zderzenie spadającego obiektu $2 \times 2$ o masie 200 kg na obiekt $12 \times 24$ o masie 288 kg}
    \end{figure}

    Zwiększamy masę węzłów w obiekcie $2 \times 2$ z 30 kg do 50 kg. Ponieważ w reprezentacja wizualnej węzła jego pole 
    jest proporjonalne do jego masy, tym razem obiekt $2 \times 2$ jest większy.
    Większa energia kinetyczna przy zderzeniu powoduje przerwanie kilku połączeń międzywęzłowych, a obiekt $2 \times 2$ 
    utyka w wytworzonej dziurze. Część pierwotnego obiektu $12 \times 24$ oderwała się i utkneła w obiekcie $2 \times 2$.

    \newpage
    \subsection{Wyniki dla 320 kg}
    \begin{figure}[h]

        \begin{subfigure}{0.5\textwidth}
            \centering
            \includegraphics[width=6cm, height=6cm]{collision_2x2_24x12_mass80_1} 
            \caption{Stan początkowy}
        \end{subfigure}
        \begin{subfigure}{0.5\textwidth}
            \centering
            \includegraphics[width=6cm, height=6cm]{collision_2x2_24x12_mass80_2}
            \caption{Zderzenie}
        \end{subfigure}
        \begin{subfigure}{0.5\textwidth}
            \centering
            \includegraphics[width=6cm, height=6cm]{collision_2x2_24x12_mass80_3}
            \caption{Chwila po zderzeniu}
        \end{subfigure}
        \begin{subfigure}{0.5\textwidth}
            \centering
            \includegraphics[width=6cm, height=6cm]{collision_2x2_24x12_mass80_4}
            \caption{Stan stabilny}
        \end{subfigure}
        
        \caption{Zderzenie spadającego obiektu $2 \times 2$ o masie 320 kg na obiekt $12 \times 24$ o masie 288 kg}
    \end{figure}

    Ponowne zwiększona została masa węzłów obiektu $2 \times 2$, tym razem z 50 kg do 80 kg, dając łączną masę 320 kg.
    W chwili zderzenia po obiekcie $12 \times 24$ rozchodzi się gwałtownie fala energii kinetycznej a on sam zostaje 
    rozerwany. Częściowemu zniszczeniu ulega również obiekt $2 \times 2$, ze względu duży stosunek masy do wytrzymałości
    połączeń międzywęzłowych niektóre z nich zostały przerwane.

\chapter{Zakończenie}
    \section{Wnioski}
    Zastosowanie metoda dynamiki molekularnej daje bardzo interesujące 
    wyniki podczas symulacji zderzeń obiektów.

    \section{Dodatek}

    \subsection{Filmik prezentujące działanie aplikacji}

    \subsubsection{Przekazanie energii między dwoma sztywnimi obiektami}

    Mniejszy obiekt $3 \times 3$ po odbiciu od większego obiektu $8 \times  8$ znajdującego się 
    pod nim wznosi się na
    wysokość o wiele większą, niż ta z której rozpoczął spadek swobodny.
    Występuje tutaj przekazanie części energii z obiektu większego do mniejszego - sama zasada energii jest zachowana.
    \\
    \\
    \url{https://youtu.be/nolLh6CSa-8}

    \subsubsection{Przekazanie energii między dwoma miękkimi obiektami}
    W tym przypadku obiekty są mniej sztywne,
    obiekt $3 \times 3$ po odbiciu od obiektu $8 \times  8$ wznosi się na wyraźnie mniejszą wysokość niż w przypadku bardziej sztywnych obiektów
    (jednak wciąż wyżej niż punkt z którego zaczął spadać). Można to wytłumaczyć tym,
    że znaczna część energii która w poprzednim przypadku była częścią ruchu postępowego,
    teraz stała się energią wewnętrzną obiektów (wibracje obiektów pochłaniają część energii).
    \\
    \\
    \url{https://youtu.be/q2uYx8uLl3w}

    \subsubsection{Proste zderzenie dwóch obiektów}
    \url{https://www.youtube.com/watch?v=4cGcL_5yUt4}

    \subsection{Repozytorium}
    Repozytorium z kodem projektu znajduje się pod adresem:
    \\
    \\
    \url{https://github.com/theYiome/elastic-objects-rs}

\end{document}